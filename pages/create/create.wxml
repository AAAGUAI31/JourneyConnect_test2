<!--pages/create/create.wxml-->
<scroll-view scroll-y class="container">
  <view class="form-container">
    <!-- æ´»åŠ¨æ ‡é¢˜ -->
    <view class="form-item">
      <view class="form-label">æ´»åŠ¨æ ‡é¢˜ *</view>
      <t-input placeholder="è¯·è¾“å…¥æ´»åŠ¨æ ‡é¢˜" value="{{form.title}}" bind:change="onFieldChange" data-field="title" />
    </view>

    <!-- æ´»åŠ¨æ—¶é—´ -->
    <view class="form-item">
      <view class="form-label">æ´»åŠ¨æ—¶é—´ *</view>
      <view class="date-row">
        <view class="date-item">
          <view class="date-label">å¼€å§‹æ—¥æœŸ</view>
          <picker mode="date" value="{{form.startDate}}" bindchange="onStartDateChange">
            <view class="picker-content">{{form.startDate || 'é€‰æ‹©å¼€å§‹æ—¥æœŸ'}}</view>
          </picker>
        </view>
        <view class="date-item">
          <view class="date-label">ç»“æŸæ—¥æœŸ</view>
          <picker mode="date" value="{{form.endDate}}" bindchange="onEndDateChange">
            <view class="picker-content">{{form.endDate || 'é€‰æ‹©ç»“æŸæ—¥æœŸ'}}</view>
          </picker>
        </view>
      </view>
    </view>

    <!-- æ´»åŠ¨åœ°ç‚¹ -->
    <view class="form-item">
      <view class="form-label">æ´»åŠ¨åœ°ç‚¹ *</view>
      <view class="location-row">
        <t-input class="location-input" placeholder="è¯·è¾“å…¥åœ°ç‚¹" value="{{form.location}}" bind:change="onFieldChange" data-field="location" />
        <button class="location-btn" bindtap="onLocationSelect">
          <text class="location-icon">ğŸ“</text>
        </button>
      </view>
    </view>

    <!-- è¡Œç¨‹æè¿° -->
    <view class="form-item">
      <view class="form-label">è¡Œç¨‹æè¿° *</view>
      <t-textarea placeholder="è¯·æŒ‰å¤©æè¿°è¯¦ç»†çš„è¡Œç¨‹å®‰æ’..." value="{{form.description}}" bind:change="onFieldChange" data-field="description" maxlength="500" rows="6" />
      <view class="form-hint">æç¤ºï¼šå¯æŒ‰ "Day 1: ..." çš„æ ¼å¼åˆ†æ®µæè¿°</view>
    </view>

    <!-- æ—…è¡Œé£æ ¼ -->
    <view class="form-item">
      <view class="form-label">æ—…è¡Œé£æ ¼ *</view>
      <view class="tags-container">
        <t-tag 
          wx:for="{{styleTags}}" 
          wx:key="*this" 
          wx:for-item="tag"
          size="medium"
          theme="{{tagSelected[tag] === true ? 'primary' : 'default'}}"
          bindtap="onTagSelect"
          data-tag="{{tag}}"
        >
          {{tag}}
        </t-tag>
      </view>
    </view>

    <!-- äººæ•°ä¸Šé™ -->
    <view class="form-item">
      <view class="form-label">äººæ•°ä¸Šé™ *</view>
      <view class="stepper-container">
        <t-stepper 
          value="{{form.maxMembers}}" 
          min="2" 
          max="50" 
          bind:change="onMaxMembersChange"
        />
        <text class="stepper-unit">äºº</text>
      </view>
    </view>

    <!-- è”ç³»æ–¹å¼ -->
    <view class="form-item">
      <view class="form-label">è”ç³»æ–¹å¼ *</view>
      <t-input placeholder="å¾®ä¿¡å·æˆ–æ‰‹æœºå·" value="{{form.contact}}" bind:change="onFieldChange" data-field="contact" />
    </view>

    <!-- æ´»åŠ¨å°é¢ -->
    <view class="form-item">
      <view class="form-label">æ´»åŠ¨å°é¢</view>
      
      <!-- è°ƒè¯•ä¿¡æ¯æ˜¾ç¤ºåŒºåŸŸ -->
      <view class="debug-info" style="background: #f0f0f0; padding: 20rpx; margin-bottom: 20rpx; border-radius: 8rpx; font-size: 24rpx;">
        <view style="font-weight: bold; margin-bottom: 10rpx; display: flex; justify-content: space-between; align-items: center;">
          <text>ğŸ” è°ƒè¯•ä¿¡æ¯ï¼š</text>
          <button 
            style="font-size: 20rpx; padding: 8rpx 16rpx; background: #007aff; color: white; border: none; border-radius: 4rpx;"
            bindtap="onTestFileStatus"
            size="mini"
          >
            æµ‹è¯•çŠ¶æ€
          </button>
        </view>
        <view>æ–‡ä»¶æ•°é‡: <text style="color: {{form.coverFiles.length > 0 ? '#07c160' : '#999'}}">{{form.coverFiles.length}}</text></view>
        <view wx:if="{{form.coverFiles.length > 0}}">
          <view style="margin-top: 10rpx; font-weight: bold;">ç¬¬ä¸€ä¸ªæ–‡ä»¶ä¿¡æ¯ï¼š</view>
          <view style="margin-left: 20rpx; margin-top: 5rpx;">
            <view>  - url: <text style="color: {{form.coverFiles[0].url ? '#07c160' : '#ff3b30'}}">{{form.coverFiles[0].url || '[æ— ]'}}</text></view>
            <view>  - path: <text style="color: {{form.coverFiles[0].path ? '#07c160' : '#ff3b30'}}">{{form.coverFiles[0].path || '[æ— ]'}}</text></view>
            <view>  - tempFilePath: <text style="color: {{form.coverFiles[0].tempFilePath ? '#07c160' : '#ff3b30'}}">{{form.coverFiles[0].tempFilePath || '[æ— ]'}}</text></view>
            <view>  - filePath: <text style="color: {{form.coverFiles[0].filePath ? '#07c160' : '#ff3b30'}}">{{form.coverFiles[0].filePath || '[æ— ]'}}</text></view>
            <view>  - status: {{form.coverFiles[0].status || 'æ— '}}</view>
            <view>  - name: {{form.coverFiles[0].name || 'æ— '}}</view>
            <view>  - size: {{form.coverFiles[0].size || 'æ— '}}</view>
          </view>
          <view style="margin-top: 10rpx; padding: 10rpx; background: {{form.coverFiles[0].url || form.coverFiles[0].path || form.coverFiles[0].tempFilePath ? '#d4edda' : '#f8d7da'}}; border-radius: 4rpx;">
            <text style="font-weight: bold;">é¢„è§ˆçŠ¶æ€ï¼š</text>
            <text style="color: {{form.coverFiles[0].url || form.coverFiles[0].path || form.coverFiles[0].tempFilePath ? '#155724' : '#721c24'}}">
              {{form.coverFiles[0].url || form.coverFiles[0].path || form.coverFiles[0].tempFilePath ? '[æœ‰å¯ç”¨è·¯å¾„]' : '[æ— å¯ç”¨è·¯å¾„]'}}
            </text>
          </view>
        </view>
        <view wx:else style="color: #999;">æœªé€‰æ‹©å›¾ç‰‡</view>
      </view>
      
      <view class="cover-upload-container">
        <!-- å›¾ç‰‡é¢„è§ˆ -->
        <view wx:if="{{form.coverFiles.length > 0}}" class="cover-preview">
          <view wx:if="{{form.coverFiles[0].url}}" style="width: 100%; height: 100%;">
            <image class="cover-image" src="{{form.coverFiles[0].url}}" mode="aspectFill" />
          </view>
          <view wx:elif="{{form.coverFiles[0].path}}" style="width: 100%; height: 100%;">
            <image class="cover-image" src="{{form.coverFiles[0].path}}" mode="aspectFill" />
          </view>
          <view wx:elif="{{form.coverFiles[0].tempFilePath}}" style="width: 100%; height: 100%;">
            <image class="cover-image" src="{{form.coverFiles[0].tempFilePath}}" mode="aspectFill" />
          </view>
          <view wx:else style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: #999;">
            <text>æ— æ³•æ˜¾ç¤ºé¢„è§ˆï¼ˆè·¯å¾„ç¼ºå¤±ï¼‰</text>
          </view>
          <view class="cover-delete" bindtap="onCoverDelete">
            <text class="delete-icon">Ã—</text>
          </view>
        </view>
        <!-- ä¸Šä¼ æŒ‰é’®ï¼ˆåŠ å·ï¼‰ -->
        <t-upload
          class="cover-upload-btn"
          files="{{form.coverFiles}}"
          max="1"
          media-type="image"
          grid-config="{{gridConfig}}"
          bind:change="onCoverChange"
          bind:success="onUploadSuccess"
          bind:fail="onUploadFail"
          bind:progress="onUploadProgress"
        >
          <view slot="add-content" class="upload-add-btn" bindtap="onManualChooseImage">
            <text class="add-icon">+</text>
          </view>
        </t-upload>
      </view>
      <view class="upload-hint-text">å»ºè®®å°ºå¯¸ 750x400ï¼Œæ”¯æŒ JPGã€PNG</view>
    </view>
  </view>

  <!-- åº•éƒ¨æŒ‰é’® -->
  <view class="footer-placeholder"></view>
  <view class="footer-bar">
    <t-button theme="primary" size="large" bindtap="onSubmit" block>å‘å¸ƒæ´»åŠ¨</t-button>
  </view>
</scroll-view>

