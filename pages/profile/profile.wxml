<!--pages/profile/profile.wxml-->
<scroll-view scroll-y class="container" enable-flex>
  <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
  <view class="user-header">
    <view class="user-info-card">
      <view class="user-info">
        <t-avatar size="{{160}}" image="{{userInfo ? userInfo.avatar : ''}}" />
        <view class="user-details">
          <view class="user-name-row">
            <text class="user-name">{{userInfo ? userInfo.name : 'æœªç™»å½•'}}</text>
            <t-tag wx:if="{{userInfo && userInfo.verified}}" size="small" theme="success">å·²è®¤è¯</t-tag>
          </view>
          <text class="user-wechat" wx:if="{{userInfo && userInfo.wechat}}">å¾®ä¿¡å·ï¼š{{userInfo.wechat}}</text>
          <text class="user-signature" wx:if="{{userInfo && userInfo.signature}}">{{userInfo.signature}}</text>
        </view>
        <view class="edit-btn" bindtap="onEditProfile">
          <text class="edit-icon">âœï¸</text>
        </view>
      </view>
    </view>

    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
    <view class="stats-card">
      <view class="stats-item">
        <text class="stats-value">{{stats.createdCount || 0}}</text>
        <text class="stats-label">å‘èµ·çš„æ´»åŠ¨</text>
      </view>
      <view class="stats-item stats-divider">
        <text class="stats-value">{{stats.joinedCount || 0}}</text>
        <text class="stats-label">å‚åŠ çš„æ´»åŠ¨</text>
      </view>
      <view class="stats-item">
        <text class="stats-value">{{stats.friendsCount || 0}}</text>
        <text class="stats-label">è®¤è¯†çš„æœ‹å‹</text>
      </view>
    </view>
  </view>

  <!-- Tab åˆ‡æ¢ -->
  <view class="tabs-container">
    <t-tabs value="{{activeTab}}" bind:change="onTabChange" theme="normal">
      <t-tab-panel value="created" label="æˆ‘å‘èµ·çš„æ´»åŠ¨">
        <view class="activities-list">
          <view wx:if="{{createdActivities.length === 0}}" class="empty-state">
            <text>æš‚æ— å‘èµ·çš„æ´»åŠ¨</text>
          </view>
          <view wx:for="{{createdActivities}}" wx:key="id" wx:for-item="activity" class="activity-card" bindtap="onActivityTap" data-id="{{activity.id}}">
            <view class="card-content">
              <view class="card-left">
                <view class="activity-title">{{activity.title}}</view>
                <view class="activity-info">
                  <text class="info-item">
                    <text class="icon">ğŸ“…</text>
                    {{activity.dateRange}}
                  </text>
                  <text class="info-item">
                    <text class="icon">ğŸ“</text>
                    {{activity.location}}
                  </text>
                </view>
                <view class="activity-footer">
                  <text class="member-count">{{activity.currentMembers}}/{{activity.maxMembers}} äºº</text>
                  <t-tag size="small" theme="{{activity.status === 'æŠ¥åä¸­' ? 'success' : 'default'}}">{{activity.status}}</t-tag>
                </view>
              </view>
              <image class="activity-cover" src="{{activity.cover}}" mode="aspectFill" />
            </view>
          </view>
        </view>
      </t-tab-panel>
      <t-tab-panel value="joined" label="æˆ‘å‚åŠ çš„æ´»åŠ¨">
        <view class="activities-list">
          <view wx:if="{{joinedActivities.length === 0}}" class="empty-state">
            <text>æš‚æ— å‚åŠ çš„æ´»åŠ¨</text>
          </view>
          <view wx:for="{{joinedActivities}}" wx:key="id" wx:for-item="activity" class="activity-card" bindtap="onActivityTap" data-id="{{activity.id}}">
            <view class="card-content">
              <view class="card-left">
                <view class="activity-title">{{activity.title}}</view>
                <view class="activity-info">
                  <text class="info-item">
                    <text class="icon">ğŸ“…</text>
                    {{activity.dateRange}}
                  </text>
                  <text class="info-item">
                    <text class="icon">ğŸ“</text>
                    {{activity.location}}
                  </text>
                </view>
                <view class="activity-footer">
                  <text class="member-count">{{activity.currentMembers}}/{{activity.maxMembers}} äºº</text>
                  <t-tag size="small" theme="{{activity.status === 'æŠ¥åä¸­' ? 'success' : 'default'}}">{{activity.status}}</t-tag>
                </view>
              </view>
              <image class="activity-cover" src="{{activity.cover}}" mode="aspectFill" />
            </view>
          </view>
        </view>
      </t-tab-panel>
    </t-tabs>
  </view>

  <!-- ç™»å½•æç¤º -->
  <view wx:if="{{!isLoggedIn || !userInfo}}" class="login-prompt">
    <t-button theme="primary" size="large" bindtap="onLogin" block>å¾®ä¿¡ä¸€é”®ç™»å½•</t-button>
  </view>
</scroll-view>

<!-- ç¼–è¾‘ä¸ªäººä¿¡æ¯å¼¹çª— -->
<t-dialog visible="{{showEditDialog}}" title="ç¼–è¾‘ä¸ªäººä¿¡æ¯" bind:confirm="onSaveProfile" bind:cancel="onCancelEdit">
  <view class="edit-form">
    <view class="form-item">
      <view class="form-label">ä¸ªæ€§ç­¾å</view>
      <t-textarea placeholder="ä»‹ç»ä¸€ä¸‹è‡ªå·±..." value="{{editForm.signature}}" bind:change="onEditFormChange" data-field="signature" maxlength="100" rows="4" />
    </view>
    <view class="form-item">
      <view class="form-label">è”ç³»æ–¹å¼</view>
      <t-input placeholder="å¾®ä¿¡å·æˆ–æ‰‹æœºå·" value="{{editForm.contact}}" bind:change="onEditFormChange" data-field="contact" />
    </view>
  </view>
</t-dialog>

